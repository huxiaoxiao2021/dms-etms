<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jd.bluedragon.distribution.jy.dao.task.JyBizTaskSendVehicleDetailDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.jd.bluedragon.distribution.jy.task.JyBizTaskSendVehicleDetailEntity"
               id="jyBizTaskSendVehicleDetailMap">
        <result property="id" column="id"/>
        <result property="sendVehicleBizId" column="send_vehicle_biz_id"/>
        <result property="bizId" column="biz_id"/>
        <result property="transWorkItemCode" column="trans_work_item_code"/>
        <result property="vehicleStatus" column="vehicle_status"/>
        <result property="startSiteId" column="start_site_id"/>
        <result property="startSiteName" column="start_site_name"/>
        <result property="endSiteId" column="end_site_id"/>
        <result property="endSiteName" column="end_site_name"/>
        <result property="planDepartTime" column="plan_depart_time"/>
        <result property="sealCarTime" column="seal_car_time"/>
        <result property="createUserErp" column="create_user_erp"/>
        <result property="createUserName" column="create_user_name"/>
        <result property="updateUserErp" column="update_user_erp"/>
        <result property="updateUserName" column="update_user_name"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="yn" column="yn"/>
        <result property="ts" column="ts"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, send_vehicle_biz_id, biz_id, trans_work_item_code, vehicle_status, start_site_id, start_site_name,
        end_site_id, end_site_name, plan_depart_time, seal_car_time,
        create_user_erp, create_user_name, update_user_erp, update_user_name, create_time, update_time, yn, ts
    </sql>

    <insert id="insert" parameterType="JyBizTaskSendVehicleDetailEntity">
        insert into jy_biz_task_send_vehicle_detail
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="sendVehicleBizId != null">
                send_vehicle_biz_id,
            </if>
            <if test="bizId != null">
                biz_id,
            </if>
            <if test="transWorkItemCode != null">
                trans_work_item_code,
            </if>
            <if test="vehicleStatus != null">
                vehicle_status,
            </if>
            <if test="startSiteId != null">
                start_site_id,
            </if>
            <if test="startSiteName != null">
                start_site_name,
            </if>
            <if test="endSiteId != null">
                end_site_id,
            </if>
            <if test="endSiteName != null">
                end_site_name,
            </if>
            <if test="planDepartTime != null">
                plan_depart_time,
            </if>
            <if test="sealCarTime != null">
                seal_car_time,
            </if>
            <if test="createUserErp != null">
                create_user_erp,
            </if>
            <if test="createUserName != null">
                create_user_name,
            </if>
            <if test="updateUserErp != null">
                update_user_erp,
            </if>
            <if test="updateUserName != null">
                update_user_name,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
            <if test="yn != null">
                yn,
            </if>
            <if test="ts != null">
                ts,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="sendVehicleBizId != null">
                #{sendVehicleBizId,jdbcType=VARCHAR},
            </if>
            <if test="bizId != null">
                #{bizId,jdbcType=VARCHAR},
            </if>
            <if test="transWorkItemCode != null">
                #{transWorkItemCode,jdbcType=VARCHAR},
            </if>
            <if test="vehicleStatus != null">
                #{vehicleStatus,jdbcType=TINYINT},
            </if>
            <if test="startSiteId != null">
                #{startSiteId,jdbcType=BIGINT},
            </if>
            <if test="startSiteName != null">
                #{startSiteName,jdbcType=VARCHAR},
            </if>
            <if test="endSiteId != null">
                #{endSiteId,jdbcType=BIGINT},
            </if>
            <if test="endSiteName != null">
                #{endSiteName,jdbcType=VARCHAR},
            </if>
            <if test="planDepartTime != null">
                #{planDepartTime,jdbcType=TIMESTAMP},
            </if>
            <if test="sealCarTime != null">
                #{sealCarTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createUserErp != null">
                #{createUserErp,jdbcType=VARCHAR},
            </if>
            <if test="createUserName != null">
                #{createUserName,jdbcType=VARCHAR},
            </if>
            <if test="updateUserErp != null">
                #{updateUserErp,jdbcType=VARCHAR},
            </if>
            <if test="updateUserName != null">
                #{updateUserName,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="yn != null">
                #{yn,jdbcType=BIT},
            </if>
            <if test="ts != null">
                #{ts,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <update id="update" parameterType="JyBizTaskSendVehicleDetailEntity">
        update jy_biz_task_send_vehicle_detail
        <set>
            <if test="sendVehicleBizId != null">
                send_vehicle_biz_id = #{sendVehicleBizId,jdbcType=VARCHAR},
            </if>
            <if test="bizId != null">
                biz_id = #{bizId,jdbcType=VARCHAR},
            </if>
            <if test="transWorkItemCode != null">
                trans_work_item_code = #{transWorkItemCode,jdbcType=VARCHAR},
            </if>
            <if test="vehicleStatus != null">
                vehicle_status = #{vehicleStatus,jdbcType=TINYINT},
            </if>
            <if test="startSiteId != null">
                start_site_id = #{startSiteId,jdbcType=BIGINT},
            </if>
            <if test="startSiteName != null">
                start_site_name = #{startSiteName,jdbcType=VARCHAR},
            </if>
            <if test="endSiteId != null">
                end_site_id = #{endSiteId,jdbcType=BIGINT},
            </if>
            <if test="endSiteName != null">
                end_site_name = #{endSiteName,jdbcType=VARCHAR},
            </if>
            <if test="planDepartTime != null">
                plan_depart_time = #{planDepartTime,jdbcType=TIMESTAMP},
            </if>
            <if test="sealCarTime != null">
                seal_car_time = #{sealCarTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createUserErp != null">
                create_user_erp = #{createUserErp,jdbcType=VARCHAR},
            </if>
            <if test="createUserName != null">
                create_user_name = #{createUserName,jdbcType=VARCHAR},
            </if>
            <if test="updateUserErp != null">
                update_user_erp = #{updateUserErp,jdbcType=VARCHAR},
            </if>
            <if test="updateUserName != null">
                update_user_name = #{updateUserName,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="yn != null">
                yn = #{yn,jdbcType=BIT},
            </if>
            <if test="ts != null">
                ts = #{ts,jdbcType=TIMESTAMP},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="updateDateilTaskByVehicleBizId" parameterType="JyBizTaskSendVehicleDetailEntity">
        update jy_biz_task_send_vehicle_detail
        <set>
            <if test="sendVehicleBizId != null">
                send_vehicle_biz_id = #{sendVehicleBizId,jdbcType=VARCHAR},
            </if>
            <if test="bizId != null">
                biz_id = #{bizId,jdbcType=VARCHAR},
            </if>
            <if test="transWorkItemCode != null">
                trans_work_item_code = #{transWorkItemCode,jdbcType=VARCHAR},
            </if>
            <if test="vehicleStatus != null">
                vehicle_status = #{vehicleStatus,jdbcType=TINYINT},
            </if>
            <if test="startSiteId != null">
                start_site_id = #{startSiteId,jdbcType=BIGINT},
            </if>
            <if test="startSiteName != null">
                start_site_name = #{startSiteName,jdbcType=VARCHAR},
            </if>
            <if test="endSiteId != null">
                end_site_id = #{endSiteId,jdbcType=BIGINT},
            </if>
            <if test="endSiteName != null">
                end_site_name = #{endSiteName,jdbcType=VARCHAR},
            </if>
            <if test="planDepartTime != null">
                plan_depart_time = #{planDepartTime,jdbcType=TIMESTAMP},
            </if>
            <if test="sealCarTime != null">
                seal_car_time = #{sealCarTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createUserErp != null">
                create_user_erp = #{createUserErp,jdbcType=VARCHAR},
            </if>
            <if test="createUserName != null">
                create_user_name = #{createUserName,jdbcType=VARCHAR},
            </if>
            <if test="updateUserErp != null">
                update_user_erp = #{updateUserErp,jdbcType=VARCHAR},
            </if>
            <if test="updateUserName != null">
                update_user_name = #{updateUserName,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="yn != null">
                yn = #{yn,jdbcType=BIT},
            </if>
            <if test="ts != null">
                ts = #{ts,jdbcType=TIMESTAMP},
            </if>
        </set>
        where send_vehicle_biz_id = #{sendVehicleBizId}
    </update>

    <select id="findByBizId" resultMap="jyBizTaskSendVehicleDetailMap" parameterType="java.lang.String">
        select
        <include refid="Base_Column_List"/>
        from jy_biz_task_send_vehicle_detail
        where yn = 1 AND biz_id = #{bizId}
        limit 1;
    </select>

    <select id="findByTransWorkItem" parameterType="JyBizTaskSendVehicleDetailEntity" resultType="java.lang.Long">
        SELECT
            id
        FROM jy_biz_task_send_vehicle_detail
        WHERE
            yn = 1
        AND trans_work_item_code = #{transWorkItemCode}
        <if test="startSiteId != null">
            AND start_site_id = #{startSiteId}
        </if>
        <if test="endSiteId != null">
            AND end_site_id = #{endSiteId}
        </if>

        ORDER BY ts DESC limit 1
    </select>

    <insert id="save" parameterType="JyBizTaskSendVehicleDetailEntity">
        INSERT INTO jy_biz_task_send_vehicle_detail
        (
            send_vehicle_biz_id,
            biz_id,
            trans_work_item_code,
            vehicle_status,
            start_site_id,
            start_site_name,
            end_site_id,
            end_site_name,
            plan_depart_time,
            create_user_erp,
            create_user_name,
            create_time,
            yn
        )
        VALUES
       (
            #{sendVehicleBizId},
            #{bizId},
            #{transWorkItemCode},
            #{vehicleStatus},
            #{startSiteId},
            #{startSiteName},
            #{endSiteId},
            #{endSiteName},
            #{planDepartTime},
            #{createUserErp},
            #{createUserName},
            NOW(),
            1
       )
    </insert>

    <select id="findByMainVehicleBiz" parameterType="JyBizTaskSendVehicleDetailEntity" resultMap="jyBizTaskSendVehicleDetailMap">
        SELECT 
            <include refid="Base_Column_List"/>
        FROM jy_biz_task_send_vehicle_detail
        WHERE
            yn = 1
            AND start_site_id = #{entity.startSiteId}
            <if test="sendVehicleBizId != null">
                AND send_vehicle_biz_id = #{sendVehicleBizId}
            </if>
            <if test="vehicleStatuses != null and vehicleStatuses.size() > 0">
                AND vehicle_status IN
                <foreach collection="vehicleStatuses" item="item" close=")" open="(" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test="entity.vehicleStatus != null">
                AND vehicle_status = #{entity.vehicleStatus}
            </if>
            <if test="entity.endSiteId != null">
                AND end_site_id = #{entity.endSiteId}
            </if>
    </select>

    <update id="updateByBiz" parameterType="JyBizTaskSendVehicleDetailEntity">
        UPDATE jy_biz_task_send_vehicle_detail
        <set>
            <if test="vehicleStatus ! = null">
                vehicle_status = #{vehicleStatus},
            </if>
            <if test="sealCarTime != null">
                seal_car_time = #{sealCarTime},
            </if>
            <if test="updateUserErp != null">
                update_user_erp = #{updateUserErp},
            </if>
            <if test="updateUserName != null">
                update_user_name = #{updateUserName},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
            <if test="yn != null">
                yn = #{yn}
            </if>
        </set>
        WHERE
            biz_id = #{bizId}
    </update>

    <select id="countByStatus" parameterType="JyBizTaskSendVehicleDetailEntity" resultType="java.lang.Integer">
        SELECT
            COUNT(*)
        FROM jy_biz_task_send_vehicle_detail
        WHERE
            yn = 1
        AND send_vehicle_biz_id = #{sendVehicleBizId}
        <if test="vehicleStatus != null">
            AND vehicle_status = #{vehicleStatus}
        </if>
    </select>
</mapper>