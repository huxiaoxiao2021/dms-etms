<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jd.bluedragon.distribution.carSchedule.dao.CarScheduleDao" >

    <resultMap id="carSchedule" type="com.jd.bluedragon.distribution.carSchedule.domain.CarScheduleTo">
        <!--<result column="id" property="id"/>-->
        <result column="car_send_code" property="carSendCode"/>
        <result column="vehicle_number" property="vehicleNumber"/>
        <result column="create_site_code" property="createSiteCode"/>
        <result column="create_site_name" property="createSiteName"/>
        <result column="receive_site_code" property="receiveSiteCode"/>
        <result column="receive_site_name" property="receiveSiteName"/>
        <result column="operate_time" property="operateTime"/>
        <result column="standard_send_time" property="standardSendTime"/>
        <result column="standard_arrive_time" property="standardArriveTime"/>
        <result column="car_send_time" property="carSendTime"/>
        <result column="car_arrive_time" property="carArriveTime"/>
        <result column="route_type" property="routeType"/>
        <result column="route_type_mark" property="routeTypeMark"/>
        <result column="transportWay" property="transportWay"/>
        <result column="transportWay_mark" property="transportWayMark"/>
        <result column="carrier_type" property="carrier_type"/>
        <result column="send_code_list" property="sendCodeList"/>
        <result column="package_num" property="packageNum"/>
        <result column="waybill_num" property="waybillNum"/>
        <!--<result column="yn" property="yn"/>-->
    </resultMap>

    <insert id="add" parameterType="carSchedule">
      INSERT INTO car_schedule_info ( car_send_code,vehicle_number,create_site_code,create_site_name,receive_site_code,receive_site_name,
      operate_time,standar_send_time,standard_arrive_time,car_send_time,car_arrive_time,route_type,route_type_mark,transportWay,transportWay_mark,
      carrier_type,send_code_list,package_num,waybill_num,is_cancel,yn,create_time,ts )
      VALUES(#{carSendCode},#{vehicleNumber},#{createSiteCode},#{createSiteName},#{receiveSiteCode},#{receiveSiteName},
       #{operateTime},#{standarSendTime},#{standarArrivaTime},#{carSendTime},#{carArriveTime},#{routeType},#{routeTypeMark},#{transportWay},
       #{transportWayMark},#{crrierType},#{sendCodeLit},#{packageNum},#{waybillNum},0,1,NOW(),NOW())
    </insert>

    <select id="getByVehicleNoAndSiteCode" parameterType="java.util.Map">
        SELECT car_send_code,vehicle_number,create_site_code,create_site_name,receive_site_code,receive_site_name,
      operate_time,standar_send_time,standard_arrive_time,car_send_time,car_arrive_time,route_type,route_type_mark,transportWay,transportWay_mark,
      carrier_type,send_code_list,package_num,waybill_num FROM car_schedule_info
        WHERE is_cancel = 0 AND yn = 1
        <if test="vehicleNumber != null">
            AND vehicleNumber = #{vehicleNumber}
        </if>
        <if test="siteCode != null">
            AND  arrive_site_code = #{siteCode}
        </if>
        AND car_send_time = MAX (car_send_time)

    </select>

    <update id="cancelSendCar" parameterType="CarSchedule">
        UPDATE car_schedule_info
        SET is_cancel = 1,update_time = #{operateTime}
        WHERE car_send_code = #{carSendCode} AND vihecle_number = #{vihecleNumber}
    </update>

    <select id="routeTypeByVehicleNo" parameterType="java.lang.String">
        SELECT route_type
        FROM car_schedule_info
        WHERE yn = 1 AND is_cancel = 0
        AND vehicle_number = #{vehicleNumber}
        AND car_send_time = MAX (car_send_time)
    </select>

    <select id="routeTypeByVehicleNoAndSiteCode" parameterType="java.util.Map">
        SELECT route_type
        FROM car_schedule_info
        WHERE yn = 1 AND is_cancel = 0
        AND vehicle_number = #{vehicleNumber}
        <if test="siteCode != null">
            AND arrive_site_code = #{siteCode}
        </if>
        AND car_send_time = MAX (car_send_time)
    </select>

    <select id="packageNumByVehicleNo" parameterType="java.lang.String">
        SELECT package_num
        FROM car_schedule_info
        WHERE yn = 1 AND is_cancel = 0
        AND vehicle_number = #{vehicleNumber}
        AND car_send_time = MAX (car_send_time)
    </select>

    <select id="packageNumByVehicleNoAndSiteCode" parameterType="java.util.Map">
        SELECT package_num
        FROM car_schedule_info
        WHERE yn = 1 AND is_cancel = 0
        AND vehicle_number = #{vehicleNumber}
        <if test="siteCode != null">
            AND arrive_site_code = #{siteCode}
        </if>
        AND car_send_time = MAX (car_send_time)
    </select>

    <select id="querySendCodesByVehicleNo" parameterType="java.lang.String">
        SELECT send_code_list FROM car_schedule_info
        WHERE yn = 1 AND is_cancel = 0
        AND vehicle_number = #{vehicle_number}
        AND car_send_time = MAX (car_send_time)
    </select>

</mapper>
