<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>规则管理UI</title>
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    #parse("system/common/baseImport.vm")
</head>
<script type="text/javascript">
$(document).ready(function() {
    // 初始化站点下拉列表
    $.ajaxHelper.doGetSync('#springUrl("/services/bases/dms")',null,function (res) {
        if (res != null) {
            var temp = "";
            $.each (res, function (index, item) {
                temp += "<option value='"+ item.siteCode +"'>" + item.siteName + "</option>";
            })
            jQuery("#siteCodeList").html(temp);
        }
    })

	if ("$!rulemanagequeryDto" != "") {
		// 初始化查询条件
		$("#siteCode").val("$!rulemanagequeryDto.siteCode");
		if ("$!pager" != "") {
			$("#pageNo").val($!pager.pageNo);
			$("#pageSize").val($!pager.pageSize);
		}
	}

	$("#search").click(function () {
        tableInit().refresh();
    })

	$("#add").click(function() {
		location.href = "#springUrl('/ruleManage/goAddPage')";
	});

    tableInit().init();
	
});

var tableInit = function() {
    var oTableInit = new Object();
    oTableInit.init = function() {
        $('#dataTable').bootstrapTable({
            url : "/ruleManage/list", // 请求后台的URL（*）
            method : 'POST', // 请求方式（*）
            toolbar : '#toolbar', // 工具按钮用哪个容器
            queryParams : oTableInit.getSearchParams, // 查询参数（*）
            uniqueId : "ID", // 每一行的唯一标识，一般为主键列
            pagination : true, // 是否显示分页（*）
            pageNumber : 1, // 初始化加载第一页，默认第一页
            pageSize : 10, // 每页的记录行数（*）
            pageList : [ 10, 25, 50, 100 ], // 可供选择的每页的行数（*）
            cache : false, // 是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            sidePagination : "server", // 分页方式：client客户端分页，server服务端分页（*）
            striped : true, // 是否显示行间隔色
            showColumns : true, // 是否显示所有的列
            sortable : true, // 是否启用排序
            sortOrder : "asc", // 排序方式
//				search : true, // 是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            showRefresh : true, // 是否显示刷新按钮
            minimumCountColumns : 2, // 最少允许的列数
            clickToSelect : true, // 是否启用点击选中行
            showToggle : true, // 是否显示详细视图和列表视图的切换按钮
            strictSearch : true,
            columns : oTableInit.tableColums
        });
    };
    oTableInit.getSearchParams = function(params) {

        var temp = oTableInit.getSearchCondition();
        if(!temp){
            temp={};
        }
        temp.pageNo = params.offset;
        temp.pageSize = params.limit;
        // 这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
        return temp;
    };
    /**
     * 获取查询参数
     * @param _selector 选择器（默认为'.search-param'）
     */
    oTableInit.getSearchCondition = function(_selector) {
        debugger
        var params = $.formHelper.serialize("search-param")
        return params;
    };

    oTableInit.tableColums = [ {
        field: 'ID',
        title: '序号',
        width:5 ,
        align:'center',
        switchable:false,
        formatter:function(value,row,index){
            return index+1;//这样的话每翻一页都会重新从1开始
        }
    }, {
        field : 'siteCode',
        title : '站点编号'
    } ,{
        field : 'type',
        title : '站点类型'
    },{
        field : 'content',
        title : '规则内容'
    },{
        field : 'inOut',
        title : '包含关系'
    },{
        field : 'createTime',
        title : '创建时间',
        formatter:function (value) {
            return $.dateHelper.formatDateTime(value)
        }
    },{
        field : 'updateUser',
        title : '操作人'
    },{
        field : 'updateTime',
        title : '更新时间',
        formatter:function (value) {
            return $.dateHelper.formatDateTime(value)
        }
    },{
        field : 'memo',
        title : '备注'
    },{
        field: 'ope',
        title: '操作',
        width:5 ,
        align:'center',
        switchable:false,
        formatter:function(value, row, index){
            var temp = "<input id=\"edit\" type=\"button\" value=\"修改\" onclick=\"edit("+ row.ruleId +")\" class=\"btn btn-default\"/>\n" +
                    "<input id=\"del\" type=\"button\" value=\"删除\" onclick=\"del(" + rule.ruleId + ")\" class=\"btn btn-default\"/>";
            return temp;
        }
    }];
    oTableInit.refresh = function() {
        $('#dataTable').bootstrapTable('refreshOptions', {pageNumber: 1});
    };
    return oTableInit;
};

function del(ruleid){
	location.href = "#springUrl('/ruleManage/del')" + "?ruleId=" + ruleid;
}

function edit(ruleid){
	location.href = "#springUrl('/ruleManage/edit')" + "?ruleId=" + ruleid;
}
</script>

<body>
<ol class="breadcrumb">
    <li><a href="#springUrl('/ruleManage/list')">基础资料管理</a></li>
    <li class="active">规则管理UI</li>
</ol>
<!--[if !ie]>breadcrumb<![endif]-->
<div id="content">
  <div style="color:red;"> $!errormsg $!successmsg</div>
  <div class="m">
    <div class="tbl-n">
      <form id="search-param" action="#springUrl('/ruleManage/list')" method="GET">
          <fieldset>
              <div class="row">
                  <input type="hidden" id="pageNo" name="pageNo" />
                  <input type="hidden" id="pageSize" name="pageSize" />
              </div>
              <div class="row">
                  <label class="control-label col-md-1 col-md-offset-1">站点编码:</label>
                  <div class="col-md-2">
                      <input id="siteCode" name="siteCode" list="siteCodeList" type="text" class="form-control"/>
                      <datalist id="siteCodeList"></datalist>
                  </div>
              </div>
          </fieldset>
      </form>
    </div>
  </div>

    <div id="toolbar" class="btn-group">
        <button id="search" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>查询
        </button>
        <button id="add" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-plus." aria-hidden="true"></span>增加
        </button>
    </div>
    <table id="dataTable"></table>


  <!--[if !ie]>tbl-n<![endif]-->
  <div id="opening">
    <div class="tbl-list">
      <div class="tbl-bg">
        <table cellspacing=0 cellpadding=0 width="100%" class="tb-x1">
          <thead>
            <tr>
			  <th>序号</th>
			  <th>站点编码</th>
              <th>规则类型</th>
              <th>规则内容</th>
              <th>包含关系</th>
              <th>创建时间</th>
              <th>操作人</th>
              <th>更新时间</th>
			  <th>备注</th>
			  <th></th>
			  <th></th>
            </tr>
          </thead>
          <tbody>
			#if($null.isNull($!ruleal) || $!ruleal.size() == 0)
				<tr class="a2" style="">
					<td colspan="16" align="left">
						无数据！
                    </td>
                </tr>
			#else
				#foreach($rule in $!ruleal)
				<tr class="a2" style="">
                  <td>$velocityCount</td>
				  <td>$!rule.siteCode</td>
                  <td>$!rule.type</td>
                  <td>$!rule.content</td>
				  <td>$!rule.inOut</td>
				  <td>$!dateTool.format("yyyy-MM-dd HH:mm:ss", $!rule.createTime)</td>
                  <td>$!rule.updateUser</td>
				  <td>$!dateTool.format("yyyy-MM-dd HH:mm:ss", $!rule.updateTime)</td>
				  <td>$!rule.memo</td>
				  <td><input id="edit" type="button" value="修改" onclick="edit($rule.ruleId)" class="btn_c"/></td>
				  <td><input id="del" type="button" value="删除" onclick="del($rule.ruleId)" class="btn_c"/></td>
                </tr>
				#end
			#end
          </tbody>
        </table>
      </div>
    </div>
    <!--[if !ie]>tbl-list<![endif]-->
    <div class="tbl-n">
		#pageBar("#springUrl('')/ruleManage/list?siteCode=$!rulemanagequeryDto.siteCode&ts=$!ts" $pager.totalSize $pager.pageNo $pager.totalNo)
    </div>
  </div>
  <!--opening end-->
</div>
</body>
</html>