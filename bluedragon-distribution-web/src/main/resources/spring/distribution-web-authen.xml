<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
    ">
	<bean id="cookieCipherTools" class="com.jd.common.web.cookie.CookieCipherTools">
		<property name="charsetName" value="utf-8" />
	</bean>

	<bean id="_jdEncryptCookie" class="com.jd.common.web.cookie.JdCookie"
		abstract="true">
		<property name="cookieCipherTools" ref="cookieCipherTools" />
		<property name="encrypt" value="true" />
		<property name="key" value="${demowebapp.cookie.key}" />
		<property name="path" value="/" />
	</bean>

	<bean id="cookieUtils" class="com.jd.common.web.cookie.CookieUtils">
		<property name="jdCookie">
			<util:list>
				<bean parent="_jdEncryptCookie">
					<property name="name" value="${login.cookie.name}" />
				</bean>
				<bean class="com.jd.common.web.cookie.JdCookie">
					<property name="name" value="${hrm.auth.cookie.name}" />
					<property name="domain" value="${hrm.auth.cookie.domain}" />
				</bean>
			</util:list>
		</property>
	</bean>

	<!-- 权限开始url related -->

	<util:map id="_urlBuilderMap">
		<entry key="homeModule">
			<bean class="com.jd.common.web.url.UrlBuilder">
				<constructor-arg value="http://${demowebapp.domain.name}/" />
			</bean>
		</entry>
		<entry key="loginUrl">
			<bean class="com.jd.common.web.url.UrlBuilder">
				<constructor-arg value="${login.address}" />
			</bean>
		</entry>
	</util:map>

	<bean id="urlBuilders" class="com.jd.common.web.url.UrlBuilders">
		<constructor-arg ref="_urlBuilderMap" />
	</bean>
	<!-- 人事接口 -->
	<bean id="hrmPrivilegeHelper" class="com.jd.common.hrm.HrmPrivilegeHelper">
		<property name="hrmAuthen" ref="hrmAuthen" />
	</bean>
 
	
<bean id="hrmAuthen" factory-bean="_deptWebServiceFactory"
		factory-method="create" />

	<bean id="_deptWebServiceFactory" class="com.jd.common.hrm.DeptWebServiceFactory">
		<property name="connectTimeout" value="${demowebapp.ws.connect.timeout}" />
		<property name="requestTimeout" value="${demowebapp.ws.request.timeout}" />
		<property name="handlers">
			<list>
				<bean class="com.jd.common.ws.AuthHandler">
					<constructor-arg>
						<bean class="com.jd.common.ws.AuthHeader">
							<property name="content" value="${demowebapp.ws.content}" />
							<property name="seed" value="${demowebapp.ws.seed}" />
						</bean>
					</constructor-arg>
				</bean>
			</list>
		</property>
	</bean>
	<!-- 权限拦截器 -->
	<mvc:interceptors>
		<!-- -->
		<bean id="_DotnetTicketContextInterceptor"
			class="com.jd.common.springmvc.interceptor.DotnetTicketContextInterceptor">
			<property name="cookieUtils" ref="cookieUtils" />
			<property name="dotnetAuthCookieName" value="${hrm.auth.cookie.name}" />
			<property name="dotnetAuthenticationKey" value="${demowebapp.hrm.login.auth.key}" />
		</bean>
		<!-- 2 -->
		<bean id="_HrmDotnetTicketLoginContextInterceptor"
			class="com.jd.common.hrm.support.HrmDotnetTicketLoginContextInterceptor">
			<property name="hrmAuthen" ref="hrmAuthen" />
			<property name="cookieUtils" ref="cookieUtils" />
			<property name="loginCookieKey" value="${login.cookie.name}" />
		</bean>
		<!-- 3 -->
		<bean id="_LoginContextInterceptor"
			class="com.jd.common.springmvc.interceptor.LoginContextInterceptor">
			<property name="cookieUtils" ref="cookieUtils" />
			<property name="loginCookieKey" value="${login.cookie.name}" />
			<property name="sessionTimeout" value="${session.timeout}" />
		</bean>
		<!-- 4 -->
		<bean id="_DotnetTicketRequiredInterceptor"
			class="com.jd.common.springmvc.interceptor.DotnetTicketRequiredInterceptor">
			<property name="urlBuilders" ref="urlBuilders" />
		</bean>
		<!-- 5 -->
		<bean id="_HrmPrivilegeInterceptor" class="com.jd.common.hrm.support.HrmPrivilegeInterceptor">
			<property name="hrmPrivilegeHelper" ref="hrmPrivilegeHelper" />
		</bean>
	</mvc:interceptors>

</beans>
